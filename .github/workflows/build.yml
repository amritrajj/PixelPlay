# This is a GitHub Actions workflow file.
# It defines a set of jobs that will run on GitHub's servers.

# Name of the workflow (you'll see this in the "Actions" tab)
name: Build Debug APK

# Controls when the action will run
on:
  # 1. Run automatically on any push to the 'main' branch
  push:
    branches: [ "main" ]
    
  # 2. Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs
jobs:
  # This job is named "build"
  build:
    # The type of machine to run the job on
    runs-on: ubuntu-latest

    # The steps the job will follow
    steps:
      # Step 1: Downloads a copy of your repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Sets up the Java environment (JDK 17) needed for this project
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # Step 3: Caches Gradle dependencies to speed up future builds
      - name: Setup Gradle cache
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/libs.versions.toml') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      # Step 4: Gives the Gradle wrapper file permission to run
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # Step 5: Runs the command to build the debug APK
      # This is the same command you would run locally
      - name: Build with Gradle
        run: ./gradlew assembleDebug

      # Step 6: Takes the built APK and saves it as an "artifact"
      # This allows you to download it from the workflow run page
      - name: Upload Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: pixelplay-debug-apk
          path: app/build/outputs/apk/debug/app-debug.apk
